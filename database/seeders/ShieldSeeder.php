<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use BezhanSalleh\FilamentShield\Support\Utils;
use Spatie\Permission\PermissionRegistrar;

class ShieldSeeder extends Seeder
{
    public function run(): void
    {
        app()[PermissionRegistrar::class]->forgetCachedPermissions();

        $rolesWithPermissions = '[{"name":"super_admin","guard_name":"web","permissions":["view_employee::employee","view_any_employee::employee","create_employee::employee","update_employee::employee","restore_employee::employee","restore_any_employee::employee","replicate_employee::employee","reorder_employee::employee","delete_employee::employee","delete_any_employee::employee","force_delete_employee::employee","force_delete_any_employee::employee","view_finance::account::payable::account::payable","view_any_finance::account::payable::account::payable","create_finance::account::payable::account::payable","update_finance::account::payable::account::payable","restore_finance::account::payable::account::payable","restore_any_finance::account::payable::account::payable","replicate_finance::account::payable::account::payable","reorder_finance::account::payable::account::payable","delete_finance::account::payable::account::payable","delete_any_finance::account::payable::account::payable","force_delete_finance::account::payable::account::payable","force_delete_any_finance::account::payable::account::payable","view_finance::accounting::accounting","view_any_finance::accounting::accounting","create_finance::accounting::accounting","update_finance::accounting::accounting","restore_finance::accounting::accounting","restore_any_finance::accounting::accounting","replicate_finance::accounting::accounting","reorder_finance::accounting::accounting","delete_finance::accounting::accounting","delete_any_finance::accounting::accounting","force_delete_finance::accounting::accounting","force_delete_any_finance::accounting::accounting","view_finance::billing::bill","view_any_finance::billing::bill","create_finance::billing::bill","update_finance::billing::bill","restore_finance::billing::bill","restore_any_finance::billing::bill","replicate_finance::billing::bill","reorder_finance::billing::bill","delete_finance::billing::bill","delete_any_finance::billing::bill","force_delete_finance::billing::bill","force_delete_any_finance::billing::bill","view_finance::shipping::collection::shipping::collection","view_any_finance::shipping::collection::shipping::collection","create_finance::shipping::collection::shipping::collection","update_finance::shipping::collection::shipping::collection","restore_finance::shipping::collection::shipping::collection","restore_any_finance::shipping::collection::shipping::collection","replicate_finance::shipping::collection::shipping::collection","reorder_finance::shipping::collection::shipping::collection","delete_finance::shipping::collection::shipping::collection","delete_any_finance::shipping::collection::shipping::collection","force_delete_finance::shipping::collection::shipping::collection","force_delete_any_finance::shipping::collection::shipping::collection","view_finance::supplie::supplie","view_any_finance::supplie::supplie","create_finance::supplie::supplie","update_finance::supplie::supplie","restore_finance::supplie::supplie","restore_any_finance::supplie::supplie","replicate_finance::supplie::supplie","reorder_finance::supplie::supplie","delete_finance::supplie::supplie","delete_any_finance::supplie::supplie","force_delete_finance::supplie::supplie","force_delete_any_finance::supplie::supplie","view_finance::tax::tax","view_any_finance::tax::tax","create_finance::tax::tax","update_finance::tax::tax","restore_finance::tax::tax","restore_any_finance::tax::tax","replicate_finance::tax::tax","reorder_finance::tax::tax","delete_finance::tax::tax","delete_any_finance::tax::tax","force_delete_finance::tax::tax","force_delete_any_finance::tax::tax","view_operational::document::fiscal::customer::document::fiscal::customer","view_any_operational::document::fiscal::customer::document::fiscal::customer","create_operational::document::fiscal::customer::document::fiscal::customer","update_operational::document::fiscal::customer::document::fiscal::customer","restore_operational::document::fiscal::customer::document::fiscal::customer","restore_any_operational::document::fiscal::customer::document::fiscal::customer","replicate_operational::document::fiscal::customer::document::fiscal::customer","reorder_operational::document::fiscal::customer::document::fiscal::customer","delete_operational::document::fiscal::customer::document::fiscal::customer","delete_any_operational::document::fiscal::customer::document::fiscal::customer","force_delete_operational::document::fiscal::customer::document::fiscal::customer","force_delete_any_operational::document::fiscal::customer::document::fiscal::customer","view_operational::lot::lot","view_any_operational::lot::lot","create_operational::lot::lot","update_operational::lot::lot","restore_operational::lot::lot","restore_any_operational::lot::lot","replicate_operational::lot::lot","reorder_operational::lot::lot","delete_operational::lot::lot","delete_any_operational::lot::lot","force_delete_operational::lot::lot","force_delete_any_operational::lot::lot","view_operational::multi::software::multi::software","view_any_operational::multi::software::multi::software","create_operational::multi::software::multi::software","update_operational::multi::software::multi::software","restore_operational::multi::software::multi::software","restore_any_operational::multi::software::multi::software","replicate_operational::multi::software::multi::software","reorder_operational::multi::software::multi::software","delete_operational::multi::software::multi::software","delete_any_operational::multi::software::multi::software","force_delete_operational::multi::software::multi::software","force_delete_any_operational::multi::software::multi::software","view_operational::transport::document::transport::document","view_any_operational::transport::document::transport::document","create_operational::transport::document::transport::document","update_operational::transport::document::transport::document","restore_operational::transport::document::transport::document","restore_any_operational::transport::document::transport::document","replicate_operational::transport::document::transport::document","reorder_operational::transport::document::transport::document","delete_operational::transport::document::transport::document","delete_any_operational::transport::document::transport::document","force_delete_operational::transport::document::transport::document","force_delete_any_operational::transport::document::transport::document","view_register::bank::bank","view_any_register::bank::bank","create_register::bank::bank","update_register::bank::bank","restore_register::bank::bank","restore_any_register::bank::bank","replicate_register::bank::bank","reorder_register::bank::bank","delete_register::bank::bank","delete_any_register::bank::bank","force_delete_register::bank::bank","force_delete_any_register::bank::bank","view_register::code::uf::code::uf","view_any_register::code::uf::code::uf","create_register::code::uf::code::uf","update_register::code::uf::code::uf","restore_register::code::uf::code::uf","restore_any_register::code::uf::code::uf","replicate_register::code::uf::code::uf","reorder_register::code::uf::code::uf","delete_register::code::uf::code::uf","delete_any_register::code::uf::code::uf","force_delete_register::code::uf::code::uf","force_delete_any_register::code::uf::code::uf","view_register::costcenter::costcenter","view_any_register::costcenter::costcenter","create_register::costcenter::costcenter","update_register::costcenter::costcenter","restore_register::costcenter::costcenter","restore_any_register::costcenter::costcenter","replicate_register::costcenter::costcenter","reorder_register::costcenter::costcenter","delete_register::costcenter::costcenter","delete_any_register::costcenter::costcenter","force_delete_register::costcenter::costcenter","force_delete_any_register::costcenter::costcenter","view_register::customer::customer","view_any_register::customer::customer","create_register::customer::customer","update_register::customer::customer","restore_register::customer::customer","restore_any_register::customer::customer","replicate_register::customer::customer","reorder_register::customer::customer","delete_register::customer::customer","delete_any_register::customer::customer","force_delete_register::customer::customer","force_delete_any_register::customer::customer","view_register::freight::table::freight::table","view_any_register::freight::table::freight::table","create_register::freight::table::freight::table","update_register::freight::table::freight::table","restore_register::freight::table::freight::table","restore_any_register::freight::table::freight::table","replicate_register::freight::table::freight::table","reorder_register::freight::table::freight::table","delete_register::freight::table::freight::table","delete_any_register::freight::table::freight::table","force_delete_register::freight::table::freight::table","force_delete_any_register::freight::table::freight::table","view_register::group::customer::group::customer","view_any_register::group::customer::group::customer","create_register::group::customer::group::customer","update_register::group::customer::group::customer","restore_register::group::customer::group::customer","restore_any_register::group::customer::group::customer","replicate_register::group::customer::group::customer","reorder_register::group::customer::group::customer","delete_register::group::customer::group::customer","delete_any_register::group::customer::group::customer","force_delete_register::group::customer::group::customer","force_delete_any_register::group::customer::group::customer","view_register::nature::nature","view_any_register::nature::nature","create_register::nature::nature","update_register::nature::nature","restore_register::nature::nature","restore_any_register::nature::nature","replicate_register::nature::nature","reorder_register::nature::nature","delete_register::nature::nature","delete_any_register::nature::nature","force_delete_register::nature::nature","force_delete_any_register::nature::nature","view_register::payment::term::payment::term","view_any_register::payment::term::payment::term","create_register::payment::term::payment::term","update_register::payment::term::payment::term","restore_register::payment::term::payment::term","restore_any_register::payment::term::payment::term","replicate_register::payment::term::payment::term","reorder_register::payment::term::payment::term","delete_register::payment::term::payment::term","delete_any_register::payment::term::payment::term","force_delete_register::payment::term::payment::term","force_delete_any_register::payment::term::payment::term","view_register::receiving::type::receiving::type","view_any_register::receiving::type::receiving::type","create_register::receiving::type::receiving::type","update_register::receiving::type::receiving::type","restore_register::receiving::type::receiving::type","restore_any_register::receiving::type::receiving::type","replicate_register::receiving::type::receiving::type","reorder_register::receiving::type::receiving::type","delete_register::receiving::type::receiving::type","delete_any_register::receiving::type::receiving::type","force_delete_register::receiving::type::receiving::type","force_delete_any_register::receiving::type::receiving::type","view_register::route::route","view_any_register::route::route","create_register::route::route","update_register::route::route","restore_register::route::route","restore_any_register::route::route","replicate_register::route::route","reorder_register::route::route","delete_register::route::route","delete_any_register::route::route","force_delete_register::route::route","force_delete_any_register::route::route","view_register::vendor::vendor","view_any_register::vendor::vendor","create_register::vendor::vendor","update_register::vendor::vendor","restore_register::vendor::vendor","restore_any_register::vendor::vendor","replicate_register::vendor::vendor","reorder_register::vendor::vendor","delete_register::vendor::vendor","delete_any_register::vendor::vendor","force_delete_register::vendor::vendor","force_delete_any_register::vendor::vendor","view_role","view_any_role","create_role","update_role","delete_role","delete_any_role","view_settings::branch::branch","view_any_settings::branch::branch","create_settings::branch::branch","update_settings::branch::branch","restore_settings::branch::branch","restore_any_settings::branch::branch","replicate_settings::branch::branch","reorder_settings::branch::branch","delete_settings::branch::branch","delete_any_settings::branch::branch","force_delete_settings::branch::branch","force_delete_any_settings::branch::branch","view_settings::edi::pattern::edi::pattern","view_any_settings::edi::pattern::edi::pattern","create_settings::edi::pattern::edi::pattern","update_settings::edi::pattern::edi::pattern","restore_settings::edi::pattern::edi::pattern","restore_any_settings::edi::pattern::edi::pattern","replicate_settings::edi::pattern::edi::pattern","reorder_settings::edi::pattern::edi::pattern","delete_settings::edi::pattern::edi::pattern","delete_any_settings::edi::pattern::edi::pattern","force_delete_settings::edi::pattern::edi::pattern","force_delete_any_settings::edi::pattern::edi::pattern","view_settings::situation::situation","view_any_settings::situation::situation","create_settings::situation::situation","update_settings::situation::situation","restore_settings::situation::situation","restore_any_settings::situation::situation","replicate_settings::situation::situation","reorder_settings::situation::situation","delete_settings::situation::situation","delete_any_settings::situation::situation","force_delete_settings::situation::situation","force_delete_any_settings::situation::situation","view_settings::user::user","view_any_settings::user::user","create_settings::user::user","update_settings::user::user","restore_settings::user::user","restore_any_settings::user::user","replicate_settings::user::user","reorder_settings::user::user","delete_settings::user::user","delete_any_settings::user::user","force_delete_settings::user::user","force_delete_any_settings::user::user","view_shield::role::role","view_any_shield::role::role","create_shield::role::role","update_shield::role::role","delete_shield::role::role","delete_any_shield::role::role","view_shield::token::token","view_any_shield::token::token","create_shield::token::token","update_shield::token::token","restore_shield::token::token","restore_any_shield::token::token","replicate_shield::token::token","reorder_shield::token::token","delete_shield::token::token","delete_any_shield::token::token","force_delete_shield::token::token","force_delete_any_shield::token::token","view_token","view_any_token","create_token","update_token","restore_token","restore_any_token","replicate_token","reorder_token","delete_token","delete_any_token","force_delete_token","force_delete_any_token","page_Settings","widget_BillingChart"]},{"name":"Users","guard_name":"web","permissions":["view_finance::account::payable::account::payable","view_any_finance::account::payable::account::payable","create_finance::account::payable::account::payable","update_finance::account::payable::account::payable","restore_finance::account::payable::account::payable","restore_any_finance::account::payable::account::payable","replicate_finance::account::payable::account::payable","reorder_finance::account::payable::account::payable","delete_finance::account::payable::account::payable","delete_any_finance::account::payable::account::payable","force_delete_finance::account::payable::account::payable","force_delete_any_finance::account::payable::account::payable","view_finance::billing::bill","view_any_finance::billing::bill","create_finance::billing::bill","update_finance::billing::bill","restore_finance::billing::bill","restore_any_finance::billing::bill","replicate_finance::billing::bill","reorder_finance::billing::bill","delete_finance::billing::bill","delete_any_finance::billing::bill","force_delete_finance::billing::bill","force_delete_any_finance::billing::bill","view_finance::shipping::collection::shipping::collection","view_any_finance::shipping::collection::shipping::collection","create_finance::shipping::collection::shipping::collection","update_finance::shipping::collection::shipping::collection","restore_finance::shipping::collection::shipping::collection","restore_any_finance::shipping::collection::shipping::collection","replicate_finance::shipping::collection::shipping::collection","reorder_finance::shipping::collection::shipping::collection","delete_finance::shipping::collection::shipping::collection","delete_any_finance::shipping::collection::shipping::collection","force_delete_finance::shipping::collection::shipping::collection","force_delete_any_finance::shipping::collection::shipping::collection","page_Settings","widget_BillingChart"]}]';
        $directPermissions = '{"348":{"name":"page_AlterBranch","guard_name":"web"}}';

        static::makeRolesWithPermissions($rolesWithPermissions);
        static::makeDirectPermissions($directPermissions);

        $this->command->info('Shield Seeding Completed.');
    }

    protected static function makeRolesWithPermissions(string $rolesWithPermissions): void
    {
        if (! blank($rolePlusPermissions = json_decode($rolesWithPermissions, true))) {
            /** @var Model $roleModel */
            $roleModel = Utils::getRoleModel();
            /** @var Model $permissionModel */
            $permissionModel = Utils::getPermissionModel();

            foreach ($rolePlusPermissions as $rolePlusPermission) {
                $role = $roleModel::firstOrCreate([
                    'name' => $rolePlusPermission['name'],
                    'guard_name' => $rolePlusPermission['guard_name'],
                ]);

                if (! blank($rolePlusPermission['permissions'])) {
                    $permissionModels = collect($rolePlusPermission['permissions'])
                        ->map(fn ($permission) => $permissionModel::firstOrCreate([
                            'name' => $permission,
                            'guard_name' => $rolePlusPermission['guard_name'],
                        ]))
                        ->all();

                    $role->syncPermissions($permissionModels);
                }
            }
        }
    }

    public static function makeDirectPermissions(string $directPermissions): void
    {
        if (! blank($permissions = json_decode($directPermissions, true))) {
            /** @var Model $permissionModel */
            $permissionModel = Utils::getPermissionModel();

            foreach ($permissions as $permission) {
                if ($permissionModel::whereName($permission)->doesntExist()) {
                    $permissionModel::create([
                        'name' => $permission['name'],
                        'guard_name' => $permission['guard_name'],
                    ]);
                }
            }
        }
    }
}
